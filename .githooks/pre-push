#!/usr/bin/env bash
# Prevent pushing directly to protected branches (main by default)

protected_branches=("main" "master")

while read -r local_ref local_sha remote_ref remote_sha; do
  # Only care about branch refs
  if [[ $remote_ref == refs/heads/* ]]; then
    branch_name=${remote_ref#refs/heads/}
    for protected in "${protected_branches[@]}"; do
      if [[ "$branch_name" == "$protected" ]]; then
        echo "Push to protected branch '$branch_name' is blocked."
        echo "Create a PR from a feature branch instead."
        exit 1
      fi
    done
  fi
done

exit 0
